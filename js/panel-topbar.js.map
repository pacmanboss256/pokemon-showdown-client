{"version":3,"sources":["../src/panel-topbar.tsx"],"names":["window","addEventListener","e","console","log","dataTransfer","dropEffect","target","test","type","PS","dragging","preventDefault","PSHeader","handleDragEnter","currentTarget","draggingRoom","roomid","draggedOverRoom","router","extractRoomID","href","leftIndex","leftRoomList","indexOf","dragOnto","rightIndex","rightRoomList","handleDragStart","fromRoom","toRoomList","toIndex","roomLists","fromRoomList","fromIndex","roomList","length","splice","room","rooms","location","leftRoom","id","mainmenu","rightRoom","update","renderRoomTab","closable","cur","isVisible","notifying","notifications","isSubtleNotifying","className","icon","title","closeButton","idChunks","substr","split","formatid","battle","p1","name","p2","charAt","closeBracketIndex","slice","renderUser","connected","user","userid","named","userColor","BattleLog","color","usernameColor","render","props","style","Config","routes","client","map","marginLeft","leftRoomWidth","prefs","mute","preact","Component","document","body","getElementById","UserRoom","options","classType","isSelf","username","send","PSRoom","UserPanel","userdetailsCache","avatar","group","server","getGroup","groupName","globalGroup","globalGroupName","roomsList","battlebuf","chatbuf","privatebuf","curRoom","roomrank","toRoomid","ownBattle","toUserid","roomLink","isPrivate","push","unshift","away","status","startsWith","Dex","resolveAvatar","users","PSRoomPanel","roomTypes","Model","VolumePanel","setVolume","slider","set","Number","value","forceUpdate","setMute","checkbox","checked","componentDidMount","subscriptions","subscribe","effectvolume","musicvolume","notifvolume","OptionsPanel","setCheckbox","dark"],"mappings":"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","sourcesContent":["/**\r\n * Topbar Panel\r\n *\r\n * Topbar view - handles the topbar and some generic popups.\r\n *\r\n * Also handles global drag-and-drop support.\r\n *\r\n * @author Guangcong Luo <guangcongluo@gmail.com>\r\n * @license AGPLv3\r\n */\r\n\r\nwindow.addEventListener('drop', e => {\r\n\tconsole.log('drop ' + e.dataTransfer!.dropEffect);\r\n\tconst target = e.target as HTMLElement;\r\n\tif (/^text/.test((target as HTMLInputElement).type)) {\r\n\t\tPS.dragging = null;\r\n\t\treturn; // Ignore text fields\r\n\t}\r\n\r\n\t// The default team drop action for Firefox is to open the team as a\r\n\t// URL, which needs to be prevented.\r\n\t// The default file drop action for most browsers is to open the file\r\n\t// in the tab, which is generally undesirable anyway.\r\n\te.preventDefault();\r\n\tPS.dragging = null;\r\n});\r\nwindow.addEventListener('dragend', e => {\r\n\te.preventDefault();\r\n\tPS.dragging = null;\r\n});\r\nwindow.addEventListener('dragover', e => {\r\n\t// this prevents the bounce-back animation\r\n\te.preventDefault();\r\n});\r\n\r\nclass PSHeader extends preact.Component<{style: {}}> {\r\n\thandleDragEnter = (e: DragEvent) => {\r\n\t\tconsole.log('dragenter ' + e.dataTransfer!.dropEffect);\r\n\t\te.preventDefault();\r\n\t\tif (!PS.dragging) return; // TODO: handle dragging other things onto roomtabs\r\n\t\t/** the element being passed over */\r\n\t\tconst target = e.currentTarget as HTMLAnchorElement;\r\n\r\n\t\tconst draggingRoom = PS.dragging.roomid;\r\n\t\tif (draggingRoom === null) return;\r\n\r\n\t\tconst draggedOverRoom = PS.router.extractRoomID(target.href);\r\n\t\tif (draggedOverRoom === null) return; // should never happen\r\n\t\tif (draggingRoom === draggedOverRoom) return;\r\n\r\n\t\tconst leftIndex = PS.leftRoomList.indexOf(draggedOverRoom);\r\n\t\tif (leftIndex >= 0) {\r\n\t\t\tthis.dragOnto(draggingRoom, 'leftRoomList', leftIndex);\r\n\t\t} else {\r\n\t\t\tconst rightIndex = PS.rightRoomList.indexOf(draggedOverRoom);\r\n\t\t\tif (rightIndex >= 0) {\r\n\t\t\t\tthis.dragOnto(draggingRoom, 'rightRoomList', rightIndex);\r\n\t\t\t} else {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// dropEffect !== 'none' prevents bounce-back animation in\r\n\t\t// Chrome/Safari/Opera\r\n\t\t// if (e.dataTransfer) e.dataTransfer.dropEffect = 'move';\r\n\t};\r\n\thandleDragStart = (e: DragEvent) => {\r\n\t\tconst roomid = PS.router.extractRoomID((e.currentTarget as HTMLAnchorElement).href);\r\n\t\tif (!roomid) return; // should never happen\r\n\r\n\t\tPS.dragging = {type: 'room', roomid};\r\n\t};\r\n\tdragOnto(fromRoom: RoomID, toRoomList: 'leftRoomList' | 'rightRoomList' | 'miniRoomList', toIndex: number) {\r\n\t\t// one day you will be able to rearrange mainmenu and rooms, but not today\r\n\t\tif (fromRoom === '' || fromRoom === 'rooms') return;\r\n\r\n\t\tif (fromRoom === PS[toRoomList][toIndex]) return;\r\n\t\tif (fromRoom === '' && toRoomList === 'miniRoomList') return;\r\n\r\n\t\tconst roomLists = ['leftRoomList', 'rightRoomList', 'miniRoomList'] as const;\r\n\t\tlet fromRoomList;\r\n\t\tlet fromIndex = -1;\r\n\t\tfor (const roomList of roomLists) {\r\n\t\t\tfromIndex = PS[roomList].indexOf(fromRoom);\r\n\t\t\tif (fromIndex >= 0) {\r\n\t\t\t\tfromRoomList = roomList;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!fromRoomList) return; // shouldn't happen\r\n\r\n\t\tif (toRoomList === 'leftRoomList' && toIndex === 0) toIndex = 1; // Home is always leftmost\r\n\t\tif (toRoomList === 'rightRoomList' && toIndex === PS.rightRoomList.length - 1) toIndex--; // Rooms is always rightmost\r\n\r\n\t\tPS[fromRoomList].splice(fromIndex, 1);\r\n\t\t// if dragging within the same roomlist and toIndex > fromIndex,\r\n\t\t// toIndex is offset by 1 now. Fortunately for us, we want to\r\n\t\t// drag to the right of this tab in that case, so the -1 +1\r\n\t\t// cancel out\r\n\t\tPS[toRoomList].splice(toIndex, 0, fromRoom);\r\n\r\n\t\tconst room = PS.rooms[fromRoom]!;\r\n\t\tswitch (toRoomList) {\r\n\t\tcase 'leftRoomList': room.location = 'left'; break;\r\n\t\tcase 'rightRoomList': room.location = 'right'; break;\r\n\t\tcase 'miniRoomList': room.location = 'mini-window'; break;\r\n\t\t}\r\n\t\tif (fromRoomList !== toRoomList) {\r\n\t\t\tif (fromRoom === PS.leftRoom.id) {\r\n\t\t\t\tPS.leftRoom = PS.mainmenu;\r\n\t\t\t} else if (PS.rightRoom && fromRoom === PS.rightRoom.id) {\r\n\t\t\t\tPS.rightRoom = PS.rooms['rooms']!;\r\n\t\t\t}\r\n\t\t\tif (toRoomList === 'rightRoomList') {\r\n\t\t\t\tPS.rightRoom = room;\r\n\t\t\t} else if (toRoomList === 'leftRoomList') {\r\n\t\t\t\tPS.leftRoom = room;\r\n\t\t\t}\r\n\t\t}\r\n\t\tPS.update();\r\n\t}\r\n\trenderRoomTab(id: RoomID) {\r\n\t\tconst room = PS.rooms[id]!;\r\n\t\tconst closable = (id === '' || id === 'rooms' ? '' : ' closable');\r\n\t\tconst cur = PS.isVisible(room) ? ' cur' : '';\r\n\t\tconst notifying = room.notifications.length ? ' notifying' : room.isSubtleNotifying ? ' subtle-notifying' : '';\r\n\t\tlet className = `roomtab button${notifying}${closable}${cur}`;\r\n\t\tlet icon = null;\r\n\t\tlet title = room.title;\r\n\t\tlet closeButton = null;\r\n\t\tswitch (room.type) {\r\n\t\tcase '':\r\n\t\tcase 'mainmenu':\r\n\t\t\ticon = <i class=\"fa fa-home\"></i>;\r\n\t\t\tbreak;\r\n\t\tcase 'teambuilder':\r\n\t\t\ticon = <i class=\"fa fa-pencil-square-o\"></i>;\r\n\t\t\tbreak;\r\n\t\tcase 'ladder':\r\n\t\tcase 'ladderformat':\r\n\t\t\ticon = <i class=\"fa fa-list-ol\"></i>;\r\n\t\t\tbreak;\r\n\t\tcase 'battles':\r\n\t\t\ticon = <i class=\"fa fa-caret-square-o-right\"></i>;\r\n\t\t\tbreak;\r\n\t\tcase 'rooms':\r\n\t\t\ticon = <i class=\"fa fa-plus\" style=\"margin:7px auto -6px auto\"></i>;\r\n\t\t\ttitle = '';\r\n\t\t\tbreak;\r\n\t\tcase 'battle':\r\n\t\t\tlet idChunks = id.substr(7).split('-');\r\n\t\t\tlet formatid;\r\n\t\t\t// TODO: relocate to room implementation\r\n\t\t\tif (idChunks.length <= 1) {\r\n\t\t\t\tif (idChunks[0] === 'uploadedreplay') formatid = 'Uploaded Replay';\r\n\t\t\t} else {\r\n\t\t\t\tformatid = idChunks[0];\r\n\t\t\t}\r\n\t\t\tif (!title) {\r\n\t\t\t\tlet battle = (room as any).battle as Battle | undefined;\r\n\t\t\t\tlet p1 = battle?.p1?.name || '';\r\n\t\t\t\tlet p2 = battle?.p2?.name || '';\r\n\t\t\t\tif (p1 && p2) {\r\n\t\t\t\t\ttitle = `${p1} v. ${p2}`;\r\n\t\t\t\t} else if (p1 || p2) {\r\n\t\t\t\t\ttitle = `${p1}${p2}`;\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttitle = `(empty room)`;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\ticon = <i class=\"text\">{formatid}</i>;\r\n\t\t\tbreak;\r\n\t\tcase 'chat':\r\n\t\t\ticon = <i class=\"fa fa-comment-o\"></i>;\r\n\t\t\tbreak;\r\n\t\tcase 'html':\r\n\t\tdefault:\r\n\t\t\tif (title.charAt(0) === '[') {\r\n\t\t\t\tlet closeBracketIndex = title.indexOf(']');\r\n\t\t\t\tif (closeBracketIndex > 0) {\r\n\t\t\t\t\ticon = <i class=\"text\">{title.slice(1, closeBracketIndex)}</i>;\r\n\t\t\t\t\ttitle = title.slice(closeBracketIndex + 1);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\ticon = <i class=\"fa fa-file-text-o\"></i>;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tif (closable) {\r\n\t\t\tcloseButton = <button class=\"closebutton\" name=\"closeRoom\" value={id} aria-label=\"Close\">\r\n\t\t\t\t<i class=\"fa fa-times-circle\"></i>\r\n\t\t\t</button>;\r\n\t\t}\r\n\t\treturn <li>\r\n\t\t\t<a\r\n\t\t\t\tclass={className} href={`/${id}`} draggable={true}\r\n\t\t\t\tonDragEnter={this.handleDragEnter} onDragStart={this.handleDragStart}\r\n\t\t\t>\r\n\t\t\t\t{icon} <span>{title}</span>\r\n\t\t\t</a>\r\n\t\t\t{closeButton}\r\n\t\t</li>;\r\n\t}\r\n\trenderUser() {\r\n\t\tif (!PS.connected) {\r\n\t\t\treturn <button class=\"button disabled\" disabled><em>Offline</em></button>;\r\n\t\t}\r\n\t\tif (!PS.user.userid) {\r\n\t\t\treturn <button class=\"button disabled\" disabled><em>Connecting...</em></button>;\r\n\t\t}\r\n\t\tif (!PS.user.named) {\r\n\t\t\treturn <a class=\"button\" href=\"login\">Choose name</a>;\r\n\t\t}\r\n\t\tconst userColor = window.BattleLog && {color: BattleLog.usernameColor(PS.user.userid)};\r\n\t\treturn <span class=\"username\" data-name={PS.user.name} style={userColor}>\r\n\t\t\t<i class=\"fa fa-user\" style=\"color:#779EC5\"></i> {PS.user.name}\r\n\t\t</span>;\r\n\t}\r\n\trender() {\r\n\t\treturn <div id=\"header\" class=\"header\" style={this.props.style}>\r\n\t\t\t<img\r\n\t\t\t\tclass=\"logo\"\r\n\t\t\t\tsrc={`https://${Config.routes.client}/pokemonshowdownbeta.png`}\r\n\t\t\t\tsrcset={`https://${Config.routes.client}/pokemonshowdownbeta@2x.png 2x`}\r\n\t\t\t\talt=\"PokÃ©mon Showdown! (beta)\"\r\n\t\t\t\twidth=\"146\" height=\"44\"\r\n\t\t\t/>\r\n\t\t\t<div class=\"maintabbarbottom\"></div>\r\n\t\t\t<div class=\"tabbar maintabbar\"><div class=\"inner\">\r\n\t\t\t\t<ul>\r\n\t\t\t\t\t{this.renderRoomTab(PS.leftRoomList[0])}\r\n\t\t\t\t</ul>\r\n\t\t\t\t<ul>\r\n\t\t\t\t\t{PS.leftRoomList.slice(1).map(roomid => this.renderRoomTab(roomid))}\r\n\t\t\t\t</ul>\r\n\t\t\t\t<ul class=\"siderooms\" style={{float: 'none', marginLeft: PS.leftRoomWidth - 144}}>\r\n\t\t\t\t\t{PS.rightRoomList.map(roomid => this.renderRoomTab(roomid))}\r\n\t\t\t\t</ul>\r\n\t\t\t</div></div>\r\n\t\t\t<div class=\"userbar\">\r\n\t\t\t\t{this.renderUser()} {}\r\n\t\t\t\t<button class=\"icon button\" name=\"joinRoom\" value=\"volume\" title=\"Sound\" aria-label=\"Sound\">\r\n\t\t\t\t\t<i class={PS.prefs.mute ? 'fa fa-volume-off' : 'fa fa-volume-up'}></i>\r\n\t\t\t\t</button> {}\r\n\t\t\t\t<button class=\"icon button\" name=\"joinRoom\" value=\"options\" title=\"Options\" aria-label=\"Options\">\r\n\t\t\t\t\t<i class=\"fa fa-cog\"></i>\r\n\t\t\t\t</button>\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n}\r\n\r\npreact.render(<PSMain />, document.body, document.getElementById('ps-frame')!);\r\n\r\n/**\r\n * User popup\r\n */\r\n\r\nclass UserRoom extends PSRoom {\r\n\treadonly classType = 'user';\r\n\tuserid: ID;\r\n\tname: string;\r\n\tisSelf: boolean;\r\n\tconstructor(options: RoomOptions) {\r\n\t\tsuper(options);\r\n\t\tthis.userid = this.id.slice(5) as ID;\r\n\t\tthis.isSelf = (this.userid === PS.user.userid);\r\n\t\tthis.name = options.username as string || this.userid;\r\n\t\tif (/[a-zA-Z0-9]/.test(this.name.charAt(0))) this.name = ' ' + this.name;\r\n\t\tPS.send(`|/cmd userdetails ${this.userid}`);\r\n\t}\r\n}\r\n\r\nclass UserPanel extends PSRoomPanel<UserRoom> {\r\n\trender() {\r\n\t\tconst room = this.props.room;\r\n\t\tconst user = PS.mainmenu.userdetailsCache[room.userid] || {userid: room.userid, avatar: '[loading]'};\r\n\t\tconst name = room.name.slice(1);\r\n\r\n\t\tconst group = PS.server.getGroup(room.name);\r\n\t\tlet groupName: preact.ComponentChild = group.name || null;\r\n\t\tif (group.type === 'punishment') {\r\n\t\t\tgroupName = <span style='color:#777777'>{groupName}</span>;\r\n\t\t}\r\n\r\n\t\tconst globalGroup = PS.server.getGroup(user.group);\r\n\t\tlet globalGroupName: preact.ComponentChild = globalGroup.name && `Global ${globalGroup.name}` || null;\r\n\t\tif (globalGroup.type === 'punishment') {\r\n\t\t\tglobalGroupName = <span style='color:#777777'>{globalGroupName}</span>;\r\n\t\t}\r\n\t\tif (globalGroup.name === group.name) groupName = null;\r\n\r\n\t\tlet roomsList: preact.ComponentChild = null;\r\n\t\tif (user.rooms) {\r\n\t\t\tlet battlebuf = [];\r\n\t\t\tlet chatbuf = [];\r\n\t\t\tlet privatebuf = [];\r\n\t\t\tfor (let roomid in user.rooms) {\r\n\t\t\t\tif (roomid === 'global') continue;\r\n\t\t\t\tconst curRoom = user.rooms[roomid];\r\n\t\t\t\tlet roomrank: preact.ComponentChild = null;\r\n\t\t\t\tif (!/[A-Za-z0-9]/.test(roomid.charAt(0))) {\r\n\t\t\t\t\troomrank = <small style=\"color: #888; font-size: 100%\">{roomid.charAt(0)}</small>;\r\n\t\t\t\t}\r\n\t\t\t\troomid = toRoomid(roomid);\r\n\r\n\t\t\t\tif (roomid.substr(0, 7) === 'battle-') {\r\n\t\t\t\t\tconst p1 = curRoom.p1!.substr(1);\r\n\t\t\t\t\tconst p2 = curRoom.p2!.substr(1);\r\n\t\t\t\t\tconst ownBattle = (PS.user.userid === toUserid(p1) || PS.user.userid === toUserid(p2));\r\n\t\t\t\t\tconst roomLink = <a href={`/${roomid}`} class={'ilink' + (ownBattle || roomid in PS.rooms ? ' yours' : '')}\r\n\t\t\t\t\t\ttitle={`${p1 || '?'} v. ${p2 || '?'}`}\r\n\t\t\t\t\t>{roomrank}{roomid.substr(7)}</a>;\r\n\t\t\t\t\tif (curRoom.isPrivate) {\r\n\t\t\t\t\t\tif (privatebuf.length) privatebuf.push(', ');\r\n\t\t\t\t\t\tprivatebuf.push(roomLink);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (battlebuf.length) battlebuf.push(', ');\r\n\t\t\t\t\t\tbattlebuf.push(roomLink);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst roomLink = <a href={`/${roomid}`} class={'ilink' + (roomid in PS.rooms ? ' yours' : '')}>\r\n\t\t\t\t\t\t{roomrank}{roomid}\r\n\t\t\t\t\t</a>;\r\n\t\t\t\t\tif (curRoom.isPrivate) {\r\n\t\t\t\t\t\tif (privatebuf.length) privatebuf.push(\", \");\r\n\t\t\t\t\t\tprivatebuf.push(roomLink);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (chatbuf.length) chatbuf.push(', ');\r\n\t\t\t\t\t\tchatbuf.push(roomLink);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (battlebuf.length) battlebuf.unshift(<br />, <em>Battles:</em>, \" \");\r\n\t\t\tif (chatbuf.length) chatbuf.unshift(<br />, <em>Chatrooms:</em>, \" \");\r\n\t\t\tif (privatebuf.length) privatebuf.unshift(<br />, <em>Private rooms:</em>, \" \");\r\n\t\t\tif (battlebuf.length || chatbuf.length || privatebuf.length) {\r\n\t\t\t\troomsList = <small class=\"rooms\">{battlebuf}{chatbuf}{privatebuf}</small>;\r\n\t\t\t}\r\n\t\t} else if (user.rooms === false) {\r\n\t\t\troomsList = <strong class=\"offline\">OFFLINE</strong>;\r\n\t\t}\r\n\r\n\t\tconst isSelf = user.userid === PS.user.userid;\r\n\t\tlet away = false;\r\n\t\tlet status = null;\r\n\t\tif (user.status) {\r\n\t\t\taway = user.status.startsWith('!');\r\n\t\t\tstatus = away ? user.status.slice(1) : user.status;\r\n\t\t}\r\n\r\n\t\treturn <PSPanelWrapper room={room}>\r\n\t\t\t<div class=\"userdetails\">\r\n\t\t\t\t{user.avatar !== '[loading]' &&\r\n\t\t\t\t\t<img\r\n\t\t\t\t\t\tclass={'trainersprite' + (room.isSelf ? ' yours' : '')}\r\n\t\t\t\t\t\tsrc={Dex.resolveAvatar('' + (user.avatar || 'unknown'))}\r\n\t\t\t\t\t/>\r\n\t\t\t\t}\r\n\t\t\t\t<strong><a href={`//${Config.routes.users}/${user.userid}`} target=\"_blank\" style={away ? {color: '#888888'} : null}>{name}</a></strong><br />\r\n\t\t\t\t{status && <div class=\"userstatus\">{status}</div>}\r\n\t\t\t\t{groupName && <div class=\"usergroup roomgroup\">{groupName}</div>}\r\n\t\t\t\t{globalGroupName && <div class=\"usergroup globalgroup\">{globalGroupName}</div>}\r\n\t\t\t\t{roomsList}\r\n\t\t\t</div>\r\n\t\t\t{isSelf || !PS.user.named ?\r\n\t\t\t\t<p class=\"buttonbar\">\r\n\t\t\t\t\t<button class=\"button disabled\" disabled>Challenge</button> {}\r\n\t\t\t\t\t<button class=\"button disabled\" disabled>Chat</button>\r\n\t\t\t\t</p>\r\n\t\t\t:\r\n\t\t\t\t<p class=\"buttonbar\">\r\n\t\t\t\t\t<button class=\"button\" data-href={`/challenge-${user.userid}`}>Challenge</button> {}\r\n\t\t\t\t\t<button class=\"button\" data-href={`/pm-${user.userid}`}>Chat</button> {}\r\n\t\t\t\t\t<button class=\"button disabled\" name=\"userOptions\">{'\\u2026'}</button>\r\n\t\t\t\t</p>\r\n\t\t\t}\r\n\t\t\t{isSelf && <hr />}\r\n\t\t\t{isSelf && <p class=\"buttonbar\" style=\"text-align: right\">\r\n\t\t\t\t<button class=\"button disabled\" name=\"login\"><i class=\"fa fa-pencil\"></i> Change name</button> {}\r\n\t\t\t\t<button class=\"button\" name=\"cmd\" value=\"/logout\"><i class=\"fa fa-power-off\"></i> Log out</button>\r\n\t\t\t</p>}\r\n\t\t</PSPanelWrapper>;\r\n\t}\r\n}\r\n\r\nPS.roomTypes['user'] = {\r\n\tModel: UserRoom,\r\n\tComponent: UserPanel,\r\n};\r\n\r\nclass VolumePanel extends PSRoomPanel {\r\n\tsetVolume = (e: Event) => {\r\n\t\tconst slider = e.currentTarget as HTMLInputElement;\r\n\t\tPS.prefs.set(slider.name as 'effectvolume', Number(slider.value));\r\n\t\tthis.forceUpdate();\r\n\t};\r\n\tsetMute = (e: Event) => {\r\n\t\tconst checkbox = e.currentTarget as HTMLInputElement;\r\n\t\tPS.prefs.set('mute', !!checkbox.checked);\r\n\t\tPS.update();\r\n\t};\r\n\tcomponentDidMount() {\r\n\t\tsuper.componentDidMount();\r\n\t\tthis.subscriptions.push(PS.prefs.subscribe(() => {\r\n\t\t\tthis.forceUpdate();\r\n\t\t}));\r\n\t}\r\n\trender() {\r\n\t\tconst room = this.props.room;\r\n\t\treturn <PSPanelWrapper room={room}>\r\n\t\t\t<h3>Volume</h3>\r\n\t\t\t<p class=\"volume\">\r\n\t\t\t\t<label class=\"optlabel\">Effects: <span class=\"value\">{!PS.prefs.mute && PS.prefs.effectvolume ? `${PS.prefs.effectvolume}%` : `muted`}</span></label>\r\n\t\t\t\t{PS.prefs.mute ?\r\n\t\t\t\t\t<em>(muted)</em> :\r\n\t\t\t\t\t<input\r\n\t\t\t\t\t\ttype=\"range\" min=\"0\" max=\"100\" step=\"1\" name=\"effectvolume\" value={PS.prefs.effectvolume}\r\n\t\t\t\t\t\tonChange={this.setVolume} onInput={this.setVolume} onKeyUp={this.setVolume}\r\n\t\t\t\t\t/>}\r\n\t\t\t</p>\r\n\t\t\t<p class=\"volume\">\r\n\t\t\t\t<label class=\"optlabel\">Music: <span class=\"value\">{!PS.prefs.mute && PS.prefs.musicvolume ? `${PS.prefs.musicvolume}%` : `muted`}</span></label>\r\n\t\t\t\t{PS.prefs.mute ?\r\n\t\t\t\t\t<em>(muted)</em> :\r\n\t\t\t\t\t<input\r\n\t\t\t\t\t\ttype=\"range\" min=\"0\" max=\"100\" step=\"1\" name=\"musicvolume\" value={PS.prefs.musicvolume}\r\n\t\t\t\t\t\tonChange={this.setVolume} onInput={this.setVolume} onKeyUp={this.setVolume}\r\n\t\t\t\t\t/>}\r\n\t\t\t</p>\r\n\t\t\t<p class=\"volume\">\r\n\t\t\t\t<label class=\"optlabel\">Notifications: <span class=\"value\">{!PS.prefs.mute && PS.prefs.notifvolume ? `${PS.prefs.notifvolume}%` : `muted`}</span></label>\r\n\t\t\t\t{PS.prefs.mute ?\r\n\t\t\t\t\t<em>(muted)</em> :\r\n\t\t\t\t\t<input\r\n\t\t\t\t\t\ttype=\"range\" min=\"0\" max=\"100\" step=\"1\" name=\"notifvolume\" value={PS.prefs.notifvolume}\r\n\t\t\t\t\t\tonChange={this.setVolume} onInput={this.setVolume} onKeyUp={this.setVolume}\r\n\t\t\t\t\t/>}\r\n\t\t\t</p>\r\n\t\t\t<p>\r\n\t\t\t\t<label class=\"checkbox\"><input type=\"checkbox\" name=\"mute\" checked={PS.prefs.mute} onChange={this.setMute} /> Mute all</label>\r\n\t\t\t</p>\r\n\t\t</PSPanelWrapper>;\r\n\t}\r\n}\r\n\r\nPS.roomTypes['volume'] = {\r\n\tComponent: VolumePanel,\r\n};\r\n\r\nclass OptionsPanel extends PSRoomPanel {\r\n\tsetCheckbox = (e: Event) => {\r\n\t\tconst checkbox = e.currentTarget as HTMLInputElement;\r\n\t\tPS.prefs.set(checkbox.name as 'dark', !!checkbox.checked);\r\n\t\tthis.forceUpdate();\r\n\t};\r\n\trender() {\r\n\t\tconst room = this.props.room;\r\n\t\treturn <PSPanelWrapper room={room}>\r\n\t\t\t<h3>Graphics</h3>\r\n\t\t\t<p>\r\n\t\t\t\t<label class=\"checkbox\"><input type=\"checkbox\" name=\"dark\" checked={PS.prefs.dark} onChange={this.setCheckbox} /> Dark mode</label>\r\n\t\t\t</p>\r\n\t\t</PSPanelWrapper>;\r\n\t}\r\n}\r\n\r\nPS.roomTypes['options'] = {\r\n\tComponent: OptionsPanel,\r\n};\r\n"],"file":"panel-topbar.js"}